<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta -->
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<!-- CSS -->
		<link
			rel="stylesheet"
			href="/css/common.css"
		/>
		<style>
			#settings-form ul {
				list-style-type: none;
				margin: 0px;
				padding-left: 15px;
			}

			#settings-form > ul > li {
				margin-top: 10px;
			}

			#settings-form > ul > li > h2 {
				margin: 0px;
			}

			#settings-form > ul ul > li {
				display: flex;
				align-items: center;
			}

			.setting-name {
				flex-grow: 1;
				font-size: 1.2em;
			}

			.setting-name + input[type="file"] {
				display: none;
			}

			.setting-name + input[type="file"] + label {
				padding: 5px;
				border-radius: 5px;
				background-color: var(--base);
			}

			.setting-name + input[type="file"] + label:hover {
				background-color: var(--surface0);
				cursor: pointer;
			}

			input[type="color"] {
				width: 70px;
				height: 35px;
				border-radius: 2px;
				cursor: pointer;
			}
		</style>
		<!-- JS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
		<script src="/js/common.js"></script>
	</head>
	<body>
		<form id="settings-form">
			<div>
				<button>Save</button>
			</div>
			<ul>
				<li>
					<h2>Profile</h2>
					<ul>
						<li>
							<span class="setting-name">Username</span
							><input name="username" />
						</li>
						<li>
							<span class="setting-name">Password</span
							><input
								name="password"
								type="password"
							/>
						</li>
					</ul>
				</li>
				<li>
					<h2>Display</h2>
					<ul>
						<li>
							<span class="setting-name">Accent Color</span
							><input
								name="accent-color"
								type="color"
							/>
						</li>
						<li>
							<span class="setting-name">Wallpaper</span
							><input
								id="wallpaper-input"
								name="wallpaper"
								type="file"
							/>
							<label for="wallpaper-input"> No wallpaper </label>
						</li>
					</ul>
				</li>
				<li>
					<h2>Taskbar</h2>
					<ul>
						<li>
							<span class="setting-name">Clock: Show seconds</span
							><input
								name="clock-show-seconds"
								type="checkbox"
							/>
						</li>
					</ul>
				</li>
			</ul>
		</form>
		<script>
			class Settings {
				constructor() {}
			}

			const form = document.forms.namedItem("settings-form");

			for (const key in settingKeys) {
				const settingKey = settingKeys[key];

				const formElement = form.elements.namedItem(settingKey);

				if (!formElement) {
					continue;
				}

				if (!(formElement instanceof HTMLInputElement)) {
					continue;
				}

				switch (formElement.type) {
					case "checkbox": {
						formElement.checked =
							localStorage.getItem(settingKey) === "true";

						break;
					}
					default: {
						formElement.value = localStorage.getItem(settingKey);
					}
				}
			}

			form.addEventListener("submit", (event) => {
				function storeElement(element) {
					if (element.type === "submit") {
						return;
					}

					switch (element.name) {
						case settingKeys.clockShowSeconds: {
							localStorage.setItem(element.name, element.checked);

							return;
						}
						case settingKeys.accentColor: {
							localStorage.setItem(
								settingKeys.onAccentColor,
								`var(${
									chroma(element.value).luminance() > 0.5
										? "--crust"
										: "--text"
								})`
							);

							break;
						}
					}

					localStorage.setItem(element.name, element.value);
				}

				for (const element of form.elements) {
					storeElement(element);
				}
			});
		</script>
	</body>
</html>
